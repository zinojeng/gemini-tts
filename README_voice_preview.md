# 語音預覽功能說明

## 功能概述

語音預覽功能讓使用者可以快速試聽不同語音的效果，無需生成完整的 TTS 內容。

## 主要特點

### 1. 即時播放
- 點擊語音選擇旁的 ▶️ 按鈕即可播放預覽
- 不顯示多餘的提示訊息（如"生成成功"）
- 直接播放音訊，提供流暢的使用體驗

### 2. 智慧快取機制
- **檔案系統快取**：預覽音訊儲存為 `preview_{語音名稱}_{語言}.wav`
- **記憶體快取**：使用 Streamlit 的 `session_state` 儲存已生成的預覽
- **語言切換處理**：當語言改變時自動清空快取，確保預覽內容正確

### 3. 預先載入選項
- 在側邊欄提供「預先載入所有語音預覽」選項
- 勾選後會在背景預先生成所有語音的預覽
- 之後點擊播放按鈕可以立即播放，無需等待

### 4. 多語言支援
每個語音都有對應語言的預覽文本：
- 中文（繁體）：「您好，我是 {語音名稱}。這是我的聲音預覽，希望您喜歡。」
- 中文（簡體）：「您好，我是 {語音名稱}。这是我的声音预览，希望您喜欢。」
- 英文：「Hello, I am {語音名稱}. This is a preview of my voice. I hope you like it.」
- 日文、韓文、西班牙文、法文、德文等

## 使用方式

### 單一講者模式
1. 在語音選擇下拉選單旁會看到 ▶️ 按鈕
2. 點擊按鈕即可播放該語音的預覽

### 多講者模式
1. 每個講者的語音選擇下方都有獨立的播放按鈕
2. 按鈕顯示為「▶️ {語音名稱}」
3. 點擊即可預覽該講者的語音效果

## 技術實現

### 快取流程
```
使用者點擊播放按鈕
    ↓
檢查 session_state 快取
    ↓ (若無)
檢查檔案系統
    ↓ (若無)
調用 API 生成預覽
    ↓
儲存到檔案系統
    ↓
加入 session_state 快取
    ↓
播放音訊
```

### 檔案結構
- `voice_preview_widget.py`：語音預覽小工具模組
- `preview_*.wav`：快取的預覽音訊檔案

## 效能優化

1. **減少 API 呼叫**：透過快取機制，相同的語音預覽只需生成一次
2. **快速響應**：已快取的預覽可以立即播放
3. **背景預載**：可選擇預先生成所有預覽，提供最佳使用體驗

## 注意事項

- 預覽檔案會儲存在應用程式目錄中
- 切換語言時會重新生成預覽
- 需要有效的 Gemini API 金鑰才能生成預覽 