# 語音預覽功能說明

## 功能概述

語音預覽功能讓使用者可以快速試聽不同語音的效果，無需生成完整的 TTS 內容。系統會在應用程式啟動時自動在背景生成所有語音預覽，確保第一次使用就能即時播放。

## 主要特點

### 1. 自動背景生成 🆕
- **應用程式啟動時自動開始**：只要有 API 金鑰，系統會立即在背景生成所有語音預覽
- **多執行緒處理**：使用背景執行緒生成，不影響主介面操作
- **智慧進度顯示**：在側邊欄顯示生成進度，完成後自動消失
- **語言感知**：根據選擇的語言生成對應的預覽

### 2. 即時播放體驗
- 點擊語音選擇旁的 ▶️ 按鈕即可播放預覽
- 不顯示任何等待提示，直接播放音訊
- 第一次使用就能立即播放（因為已在背景預先生成）

### 3. 智慧快取機制
- **檔案系統快取**：預覽音訊儲存為 `preview_{語音名稱}_{語言}.wav`
- **記憶體快取**：使用 Streamlit 的 `session_state` 儲存已生成的預覽
- **應用程式重啟保持**：已生成的預覽檔案會保留，下次啟動時直接使用
- **語言切換處理**：當語言改變時自動生成新語言的預覽

### 4. 多語言支援
每個語音都有對應語言的預覽文本：
- 中文（繁體）：「您好，我是 {語音名稱}。這是我的聲音預覽，希望您喜歡。」
- 中文（簡體）：「您好，我是 {語音名稱}。这是我的声音预览，希望您喜欢。」
- 英文：「Hello, I am {語音名稱}. This is a preview of my voice. I hope you like it.」
- 日文、韓文、西班牙文、法文、德文等

## 使用方式

### 自動模式（預設）
1. 輸入 API 金鑰後，系統自動開始背景生成
2. 在側邊欄可看到生成進度
3. 生成完成後，所有語音都可立即播放

### 單一講者模式
1. 在語音選擇下拉選單旁會看到 ▶️ 按鈕
2. 點擊按鈕即可播放該語音的預覽

### 多講者模式
1. 每個講者的語音選擇下方都有獨立的播放按鈕
2. 按鈕顯示為「▶️ {語音名稱}」
3. 點擊即可預覽該講者的語音效果

## 技術實現

### 背景生成流程
```
應用程式啟動
    ↓
檢測到 API 金鑰
    ↓
啟動背景執行緒
    ↓
逐一生成所有語音預覽
    ↓
儲存到檔案系統
    ↓
更新 session_state 快取
    ↓
顯示完成狀態
```

### 播放流程
```
使用者點擊播放按鈕
    ↓
檢查 session_state 快取
    ↓ (若無)
檢查檔案系統
    ↓
直接播放音訊
```

### 檔案結構
- `voice_preview_widget.py`：語音預覽小工具模組
- `background_preview_generator.py`：背景預覽生成器模組
- `preview_*.wav`：快取的預覽音訊檔案

## 效能優化

1. **零等待時間**：透過預先生成，實現真正的即時播放
2. **減少 API 呼叫**：相同的語音預覽只需生成一次
3. **背景處理**：不阻塞主介面，使用者可以繼續操作
4. **智慧快取**：多層快取機制確保最快的響應速度

## 注意事項

- 預覽檔案會儲存在應用程式目錄中
- 切換語言時會自動生成新語言的預覽
- 需要有效的 Gemini API 金鑰才能生成預覽
- 背景生成會適當控制速度，避免過度使用 API 