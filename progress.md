# Gemini TTS 開發進度記錄

## 2024-12-19 更新

### 問題描述
在多講者模式下，當使用範例類別（如「有聲書朗讀」、「客服對話」等）時，系統會將描述性文字和講者標籤都唸出來，而不是只唸出實際的對話內容。

**具體問題：**
- 輸入文本包含「客服和顧客的對話：」這類描述時，TTS 會將其當作語音內容
- 講者標籤（如「客服：」、「顧客：」）也會被唸出來
- 講者名稱不匹配導致 API 回應錯誤

### 解決方案

#### 1. 實現文本預處理功能
- 創建 `clean_dialogue_text()` 函數來清理對話文本
- 自動過濾掉不包含實際對話的描述性文字
- 只保留以講者名稱開頭且包含對話內容的行

#### 2. 自動識別講者名稱
- 當使用預設的「講者1」、「講者2」時，自動從範例文本中提取實際講者名稱
- 智能識別對話格式，排除只有冒號但沒有內容的描述行
- 支援中文冒號（：）和英文冒號（:）

#### 3. 改善使用者體驗
- 為講者 2 設定不同的預設語音（Puck），與講者 1（Zephyr）區分
- 添加調試信息展示區，顯示清理後的文本和識別的講者
- 提供詳細的錯誤訊息和提示

#### 4. 錯誤處理
- 檢查清理後的文本是否為空
- 驗證 API 回應的有效性
- 提供有用的錯誤訊息幫助使用者排除問題

### 技術實現細節

```python
def clean_dialogue_text(text: str, speakers: List[str]) -> tuple:
    """
    清理多講者對話文本
    - 自動識別文本中的實際講者名稱
    - 過濾掉描述性文字
    - 返回清理後的文本和實際講者列表
    """
```

### 測試結果
✅ 「播客對話」範例正常運作
✅ 「有聲書朗讀」範例成功過濾描述文字
✅ 「客服對話」範例正確識別講者
✅ 「教育內容」範例正常生成語音

### 後續優化建議
1. 支援更多講者（目前限制為 2 個）
2. 添加講者語音預覽功能
3. 支援自定義講者語音映射
4. 優化講者識別算法，支援更多格式

### 相關檔案
- `gemini_tts_app.py` - 主要應用程式（已更新）
- `gemini_tts_cli.py` - 命令列版本（待同步更新）

### Git 提交記錄
- Commit: 3d9fa1e
- Message: 修正多講者模式：自動識別講者名稱並過濾描述性文字
- Date: 2024-12-19 